@model Entidades.RendicionDetalle
@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Index";    
}

    <div class="container-fluid">
    @*<div class="row">
        <h5>Rendición de Gastos </h5>
    </div>*@



    <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
        <li class="active"><a href="#red" data-toggle="tab">Documento</a></li>
        <li><a href="#orange" data-toggle="tab">Detalle</a></li>
    </ul>

    <div id="my-tab-content" class="tab-content">
        <div class="tab-pane active" id="red">
            @using (@Html.BeginForm("Grabar", "Rendicion", FormMethod.Post, new { @id = "frm-example" }))
            {
                <br>
                <div class="row top-buffer">
                    <div class="form-group col-md-3">
                        <button type="submit" class="btn btn-success">GRABAR RENDICION</button>
                    </div>
                </div>

                <div class="row">
                    <div class="form-group col-md-2" style="font-size: 18px; font-weight: bold; color: #00539f; ">
                        @ViewBag.Mensaje
                    </div>
                </div>
     
                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Empleado:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input class="form-control input-sm" required id="FICHA_EMPLEADO" name="FICHA_EMPLEADO" value=@User.Identity.GetUserName()>
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Fecha Inicial:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input type="date" class="form-control input-sm" required  id="FECHA_RENDICION_INI" name="FECHA_RENDICION_INI" value="">
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Fecha Fin:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input type="date" class="form-control input-sm" required  id="FECHA_RENDICION_FIN" name="FECHA_RENDICION_FIN" value="">
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Fondo Inicial:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input class="form-control input-sm" id="FONDO_INICIAL" required  name="FONDO_INICIAL" value="">
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Glosa Gastos:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input class="form-control input-sm" id="GLOSA_GASTOS" required name="GLOSA_GASTOS" value="">
                    </div>
                </div>


            }
        </div>

        <div class="tab-pane" id="orange">
            <br>
            @*<div class="row top-buffer">
                <div class="form-group col-md-2 top-buffer">
                    <label class="control-label input-sm">PK_DETALLE:</label>
                </div>
                <div class="form-group col-md-3 top-buffer">
                    <input class="form-control input-sm" id="NumeroRendicion" name="NumeroRendicion" value="">
                </div>
            </div>*@
            <div class="row top-buffer">
                <div class="form-group col-md-2 top-buffer">
                    <label class="control-label input-sm">Fecha Gasto:</label>
                </div>
                <div class="form-group col-md-3 top-buffer">
                    <input type="date" class="form-control input-sm" id="fecha_gasto"   name="fecha_gasto" value="">
                </div>
            </div>
            @*<div class="row top-buffer">
                <div class="form-group col-md-2 top-buffer">
                    <label class="control-label input-sm">Tipo Documento:</label>
                </div>
                <div class="form-group col-md-3 top-buffer">
                    <input class="form-control input-sm" id="tipo_docto" name="tipo_docto" value="">
                </div>
            </div>*@
            <div class="row top-buffer">
                <div class="form-group">
                    @Html.LabelFor(model => model.TipoDocumento, htmlAttributes: new { @class = "control-label col-md-2 top-buffer" })
                    <div class="col-md-10">
                        @*@Html.EditorFor(model => model.CategoriaID, new { htmlAttributes = new { @class = "form-control" } })*@
                        @Html.DropDownListFor(model => model.TipoDocumentoID,
                                         new SelectList(ViewBag.TipoDocumentos, "TipoDocumentoID", "Documento"),
                                "Seleccione el Tipo Documento --", new { @class = "form-control top-buffer" })
                        @Html.ValidationMessageFor(model => model.TipoDocumentoID, "", new { @class = "text-danger" })
                    </div>
                </div>
            </div>


                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Número Documento:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input class="form-control input-sm" id="numero_docto"  name="numero_docto" value="">
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Razón Social:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input class="form-control input-sm" id="razon_social"  name="razon_social" value="">
                    </div>
                </div>
                <div class="row top-buffer">
                    <div class="form-group col-md-2 top-buffer">
                        <label class="control-label input-sm">Monto Linea:</label>
                    </div>
                    <div class="form-group col-md-3 top-buffer">
                        <input class="form-control input-sm" s id="monto_linea"  name="monto_linea" value="">
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.MotivoGasto, htmlAttributes: new { @class = "control-label col-md-2 top-buffer" })
                    <div class="col-md-10">
                        @*@Html.EditorFor(model => model.CategoriaID, new { htmlAttributes = new { @class = "form-control" } })*@
                        @Html.DropDownListFor(model => model.MotivoID,
                                new SelectList(ViewBag.Categorias, "MotivoID", "Motivo"),
                                "Seleccione el Motivo --", new { @class = "form-control top-buffer" })
                        @Html.ValidationMessageFor(model => model.MotivoID, "", new { @class = "text-danger" })
                    </div>
                </div>


                <div class="row">
                    <div class="form-group col-md-3">
                        <button class="btn btn-primary" onclick="Agregar(this)">AGREGAR DETALLE</button>
                    </div>
                </div>
            </div>

            <div id="example_wrapper" class="dataTables_wrapper dt-jqueryui">
                <table id="example" class="table table-bordered" cellspacing="0" role="grid" aria-describedby="example_info" style="width: 100%;">
                    <thead>
                        <tr role="row">

                            <th>Motivo ID</th>
                            <th>Motivo Gasto</th>
                            <th>Fecha Gasto</th>
                            <th>TipoDocumento ID</th>
                            <th>Tipo Documento</th>
                            <th>Número Documento</th>
                            <th>Razón Social</th>
                            <th>Monto Linea</th>
                        </tr>
                    </thead>
                    <tbody style="font-size:smaller"></tbody>
                </table>

            </div>
        </div>


        <script>


            $(document).ready(function () {
                $('#example').DataTable({

                    language: {
                        "sProcessing": "Procesando...",
                        "sLengthMenu": "Mostrar _MENU_ registros",
                        "sZeroRecords": "No se encontraron resultados",
                        "sEmptyTable": "Ningún dato disponible en esta tabla",
                        "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "sInfoPostFix": "",
                        "sSearch": "Buscar:",
                        "sUrl": "",
                        "sInfoThousands": ",",
                        "sLoadingRecords": "Cargando...",
                        "oPaginate": {
                            "sFirst": "Primero",
                            "sLast": "Último",
                            "sNext": "Siguiente",
                            "sPrevious": "Anterior"
                        },
                        "oAria": {
                            "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                        }
                    }
              ,
                    columns: [                    
                    { "data": "MotivoID" },
                    { "data": "Motivo" },
                    { "data": "fecha_gasto" },
                    { "data": "TipoDocumentoID" },
                    { "data": "Documento" },
                    { "data": "numero_docto" },
                    { "data": "razon_social" },
                    { "data": "monto_linea" }
                    ]
,
                    "columnDefs": [
                    {
                        "targets": [0],
                        "visible": false,
                        "searchable": false
                    },
                    {
                        "targets": [3],
                        "visible": false
                    }
                            ]


                });


                $('#frm-example').on('submit', function (e) {                   
                   
                   
                    //if ($("#example tbody tr").length < 1) {
                    //    alert("Falta cargar detalle"); return false;
                    //} 

                    var table = $('#example').DataTable();
                    var keys = [];
                    var data = table.rows().data();
                    data.each(function (value, index) {
                        var jsonStr = JSON.stringify(value);
                        keys.push(jsonStr);
                    });

                    $.ajax({
                        url: '@Url.Action("SessionJSON", "Rendicion")',
                        type: 'POST',
                        data: { id: keys.join() },
                        success: function (result) {
                        }
                    });

                });

            });



            function Agregar(element) {
                var numerodocDetalle = $("#numero_docto").val();              
                var razonsocial = $("#razon_social").val();
                //alert(razonsocial);
                var montolinea = $("#monto_linea").val();
                //alert(montolinea);

                if (numerodocDetalle == "") { alert("Número de documento es requerido"); return false; }
                if (razonsocial == "") { alert("Razón social es requerido"); return false; }
                if (montolinea == "") { alert("Monto de gasto es requerido"); return false; }

                var table = $('#example').DataTable();
                table.row.add({                    
                    "MotivoID": document.getElementById("MotivoID").value,
                    "Motivo": $('#MotivoID :selected').text(),//document.getElementById("Motivo").value,
                    "fecha_gasto": document.getElementById("fecha_gasto").value,
                    "TipoDocumentoID": document.getElementById("TipoDocumentoID").value,
                    "Documento": $('#TipoDocumentoID :selected').text(),//document.getElementById("TipoDocumento").value,
                    "numero_docto": document.getElementById("numero_docto").value,
                    "razon_social": document.getElementById("razon_social").value,
                    "monto_linea": document.getElementById("monto_linea").value
                }).draw();
            }
        </script>



